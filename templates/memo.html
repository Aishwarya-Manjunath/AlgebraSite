<!DOCTYPE <!DOCTYPE html>
<html>
    <head>
        <title>Memo</title>
        <link rel="stylesheet" type="text/css" href="../static/css/memo.css" />
    </head>
    <body>
        <center><h2 class="outerText">MEMO</h2></center>
        <div class="notepad">
            <div class="top"></div>
            <div id="memo" class="paper" contenteditable="False">
              Scratch Pad!
            </div>
        </div>
        <div class="buttons">
            <button id="edit" onclick="notepad.editContent()">Edit</button>
            <button id="save" onclick="notepad.saveContent()" disabled>Save</button>
        </div>
    </body>
    <script>

        localStorage['text'] = '';

        window.onbeforeunload = function(){
            alert("HELLO");
            var req = new XMLHttpRequest();
            req.open('POST', '/memo', false);
            req.onreadystatechange = function(){
                if(this.readyState == 4 && this.status == 200) {
                    console.log("DONE!");
                } 
                else {
                    console.log("Trying..");
                }
            }
            req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
            req.send("text=" + localStorage['text']);
            return 'Are you sure you want to leave?';
        };

        notepad = {
            editContent: function(){
                document.getElementById("memo").contentEditable = true;
                document.getElementById("save").disabled = false;
                document.getElementById("edit").disabled = true;
            },
            saveContent: function(){
                document.getElementById("memo").contentEditable = false;
                document.getElementById("edit").disabled = false;
                document.getElementById("save").disabled = true;
                this.storeContent();
            },
            storeContent: function(){
                var innerText = document.getElementById("memo").innerText;
                if(innerText[innerText.length-1] === '\n'){
                    innerText = innerText.slice(0,-1) 
                } 
                if(localStorage['text'].length < innerText.length){
                    localStorage['text'] = innerText;
                    alert(localStorage['text']);
                }
            }
        };

    </script>
</html>
